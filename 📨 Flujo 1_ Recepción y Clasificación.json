{
  "name": "ðŸ“¨ Flujo 1: RecepciÃ³n y ClasificaciÃ³n",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "filter-1",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "pedido",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-2",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "orden",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-3",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "recibo",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-4",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "compra",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-5",
              "leftValue": "={{ $json.bodyPreview }}",
              "rightValue": "pedido",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-6",
              "leftValue": "={{ $json.bodyPreview }}",
              "rightValue": "orden de compra",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "5f74c044-102f-4d12-bf67-95e5b31495e2",
      "name": "Filtro: Â¿Es pedido/recibo?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -192,
        112
      ]
    },
    {
      "parameters": {
        "jsCode": "// Preparar datos para enviar a Python\nconst messageData = {\n  messageId: $input.item.json.id,\n  account: $input.item.json.from?.emailAddress?.address || 'unknown',\n  accountName: $node[\"Outlook Trigger - Cuenta 1\"].name || 'Cuenta',\n  subject: $input.item.json.subject,\n  from: {\n    name: $input.item.json.from?.emailAddress?.name || '',\n    email: $input.item.json.from?.emailAddress?.address || ''\n  },\n  receivedDateTime: $input.item.json.receivedDateTime,\n  bodyPreview: $input.item.json.bodyPreview,\n  body: $input.item.json.body?.content || '',\n  hasAttachments: $input.item.json.hasAttachments || false,\n  attachments: [],\n  webLink: $input.item.json.webLink,\n  conversationId: $input.item.json.conversationId\n};\n\n// Si hay adjuntos, incluir informaciÃ³n\nif ($input.item.json.hasAttachments && $input.item.json.attachments) {\n  messageData.attachments = $input.item.json.attachments.map(att => ({\n    name: att.name,\n    contentType: att.contentType,\n    size: att.size\n  }));\n}\n\nreturn messageData;"
      },
      "id": "9fec8d15-1c9a-47d8-9fb2-8a95ed94558f",
      "name": "Preparar datos para webhook",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        256,
        416
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://TU_SERVIDOR_PYTHON:5000/api/nuevo-correo",
        "authentication": "genericCredentialType",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "={{ Object.keys($json) }}",
              "value": "={{ Object.values($json) }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "f8d8c796-c072-4878-b807-d91b77a26f84",
      "name": "Enviar a Python App",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        464,
        432
      ]
    },
    {
      "parameters": {},
      "id": "57a084ed-b105-47f8-b3d8-b97ebde4d667",
      "name": "No Match - Terminar",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        32,
        208
      ]
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {},
        "options": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTrigger",
      "typeVersion": 1,
      "position": [
        -880,
        112
      ],
      "id": "4f59a16d-d5ce-4646-9bdf-e91760cc64b8",
      "name": "Microsoft Outlook Trigger"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {},
        "options": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTrigger",
      "typeVersion": 1,
      "position": [
        -880,
        512
      ],
      "id": "3714c777-4d98-4052-8dc5-a3d973a27b0e",
      "name": "Microsoft Outlook Trigger1"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "filters": {},
        "options": {}
      },
      "type": "n8n-nodes-base.microsoftOutlookTrigger",
      "typeVersion": 1,
      "position": [
        -880,
        912
      ],
      "id": "0312d219-4b1b-4e8d-be52-2a5a7e4c3e4c",
      "name": "Microsoft Outlook Trigger2"
    },
    {
      "parameters": {
        "operation": "update",
        "messageId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "updateFields": {
          "folderId": {
            "mode": "list",
            "value": ""
          }
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        32,
        16
      ],
      "id": "108d9d0a-e7b5-4758-ba73-ab4fbbb74aa9",
      "name": "Update a message",
      "webhookId": "94c78b8a-df3e-42e4-95bb-ffcf50101b8a"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "filter-1",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "pedido",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-2",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "orden",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-3",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "recibo",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-4",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "compra",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-5",
              "leftValue": "={{ $json.bodyPreview }}",
              "rightValue": "pedido",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-6",
              "leftValue": "={{ $json.bodyPreview }}",
              "rightValue": "orden de compra",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "f257744d-0560-4609-aecd-8dc70bf0e6bf",
      "name": "Filtro: Â¿Es pedido/recibo?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -192,
        512
      ]
    },
    {
      "parameters": {},
      "id": "4e5d0865-e425-4a22-a294-b4801e472dd6",
      "name": "No Match - Terminar1",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        32,
        608
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "messageId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "updateFields": {
          "folderId": {
            "mode": "list",
            "value": ""
          }
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        32,
        416
      ],
      "id": "b05ea978-d1b7-45d5-8794-293ec86ae973",
      "name": "Update a message1",
      "webhookId": "94c78b8a-df3e-42e4-95bb-ffcf50101b8a"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "filter-1",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "pedido",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-2",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "orden",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-3",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "recibo",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-4",
              "leftValue": "={{ $json.subject }}",
              "rightValue": "compra",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-5",
              "leftValue": "={{ $json.bodyPreview }}",
              "rightValue": "pedido",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "filter-6",
              "leftValue": "={{ $json.bodyPreview }}",
              "rightValue": "orden de compra",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "a36c5fbf-97af-4d09-9a14-92062012715e",
      "name": "Filtro: Â¿Es pedido/recibo?2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -192,
        912
      ]
    },
    {
      "parameters": {},
      "id": "ea98e64b-01b9-45b0-af1c-5e01efabe6e5",
      "name": "No Match - Terminar2",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        32,
        1008
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "messageId": {
          "__rl": true,
          "mode": "list",
          "value": ""
        },
        "updateFields": {
          "folderId": {
            "mode": "list",
            "value": ""
          }
        }
      },
      "type": "n8n-nodes-base.microsoftOutlook",
      "typeVersion": 2,
      "position": [
        32,
        816
      ],
      "id": "aec11c71-7bd3-4be3-ab33-13adda588b36",
      "name": "Update a message2",
      "webhookId": "94c78b8a-df3e-42e4-95bb-ffcf50101b8a"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -608,
        0
      ],
      "id": "c8f75704-4d1f-4316-8579-24206ceb76c2",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -656,
        224
      ],
      "id": "72f8497b-81b6-4204-889c-0d771e8135ce",
      "name": "Ollama Chat Model"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryMotorhead",
      "typeVersion": 1.3,
      "position": [
        -528,
        224
      ],
      "id": "b191f3f0-9de4-4d01-be66-c99b0b1919fd",
      "name": "Motorhead"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -400,
        224
      ],
      "id": "5c7ff723-4b3f-4699-9f1b-016dde348b9c",
      "name": "MCP Client"
    },
    {
      "parameters": {
        "promptType": "define",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -608,
        400
      ],
      "id": "a7a78630-def6-4d2f-9859-79cc97d8b554",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -656,
        624
      ],
      "id": "73310dd9-1eec-498e-a767-d49cd676bd9b",
      "name": "Ollama Chat Model1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryMotorhead",
      "typeVersion": 1.3,
      "position": [
        -528,
        624
      ],
      "id": "113dfe06-0690-41b8-afd0-750779a01be9",
      "name": "Motorhead1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -400,
        624
      ],
      "id": "9adcbaef-b16a-436c-91fe-7c2f16efda07",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "promptType": "define",
        "options": {
          "systemMessage": "You are a helpful assistant"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -608,
        912
      ],
      "id": "04427ef2-f90a-4e88-9237-529a1d890293",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -656,
        1136
      ],
      "id": "fff4647b-d37b-43d9-8988-a2b7967c7f2c",
      "name": "Ollama Chat Model2"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryMotorhead",
      "typeVersion": 1.3,
      "position": [
        -528,
        1136
      ],
      "id": "b51de934-ea79-4303-9876-ab754bd7554b",
      "name": "Motorhead2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -400,
        1136
      ],
      "id": "66691c34-386d-4286-af02-64b9d54ef0e8",
      "name": "MCP Client2"
    }
  ],
  "pinData": {},
  "connections": {
    "Filtro: Â¿Es pedido/recibo?": {
      "main": [
        [
          {
            "node": "Update a message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Match - Terminar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar datos para webhook": {
      "main": [
        [
          {
            "node": "Enviar a Python App",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft Outlook Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft Outlook Trigger1": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Microsoft Outlook Trigger2": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a message": {
      "main": [
        [
          {
            "node": "Preparar datos para webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtro: Â¿Es pedido/recibo?1": {
      "main": [
        [
          {
            "node": "Update a message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Match - Terminar1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a message1": {
      "main": [
        [
          {
            "node": "Preparar datos para webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtro: Â¿Es pedido/recibo?2": {
      "main": [
        [
          {
            "node": "Update a message2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Match - Terminar2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a message2": {
      "main": [
        [
          {
            "node": "Preparar datos para webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar a Python App": {
      "main": [
        []
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Filtro: Â¿Es pedido/recibo?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Motorhead": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Motorhead1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Filtro: Â¿Es pedido/recibo?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Motorhead2": {
      "ai_memory": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client2": {
      "ai_tool": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "Filtro: Â¿Es pedido/recibo?2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "992332ef-3a33-4d25-9852-c25948970c7e",
  "meta": {
    "instanceId": "3d419a101e2f48090bc29aa7e6593e303a5524b215c50104b31a4d06de22c1b5"
  },
  "id": "RQaMv7bS8v1fuLbP",
  "tags": []
}